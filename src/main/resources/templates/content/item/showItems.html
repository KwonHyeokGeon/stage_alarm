<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/defaultLayout}"
      layout:fragment="content">
<head>
  <title>Items for Sale</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<main role="main" class="ml-sm-auto px-md-4" style="height: auto; min-height: 1500px; margin-bottom: 70px; display: flex; flex-direction: column;">
  <div class="main-container border rounded p-3 mt-2" style="flex: 1;">
    <div id="item-list" class="container mt-5">
      <!-- 상품 목록은 여기에 동적으로 로드됩니다 -->
    </div>
  </div>
</main>
<script>
  $(document).ready(function () {

    // 쿠키 값을 읽는 함수
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // 이 쿠키가 찾고 있는 쿠키인지 확인
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // 쿠키 삭제하기 위해 과거 시간 설정
    // 쿠키에서 showInfoId 값 읽기
    const showInfoId = getCookie("showInfoId");
    const url = "/" + showInfoId + "/items"
    document.cookie = "showInfoId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

    $.ajax({
      url: url,
      type: "GET",
      success: function(data) {
        var $itemList = $('#item-list');
        $.each(data, function(index, item) {
          var itemCard =
                  '<div class="col-md-4">' +
                  '<div class="card">' +
                  '<img src="' + item.itemImg + '" class="card-img-top p-3" alt="Item Image">' +
                  '<div class="card-body">' +
                  '<h5 class="card-title">' + item.name + '</h5>' +
                  '<p class="card-text">Price: ' + item.price + '</p>' +
                  '<a href="/item?id=' + item.id + '" class="btn btn-primary">사러가기</a>' +
                  '</div>' +
                  '</div>' +
                  '</div>';

          $itemList.append(itemCard);
        });
      },
      error: function (xhr, status, error) {
        console.error("AJAX 요청 실패:", status, error);
      }
    });
  });
</script>
</body>
</html>
